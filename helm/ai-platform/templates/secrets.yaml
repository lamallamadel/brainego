{{- if .Values.secrets.encryption.enabled }}
# Enable Kubernetes Secrets encryption at rest by creating EncryptionConfiguration
# This should be applied at the cluster level via kube-apiserver --encryption-provider-config
# Reference: https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/
{{- end }}
---
# PostgreSQL Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: postgres-credentials
    app.kubernetes.io/component: database
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  username: {{ .Values.secrets.postgres.username | default "YWlfdXNlcg==" }}  # ai_user
  password: {{ .Values.secrets.postgres.password }}
  database: {{ .Values.secrets.postgres.database | default "YWlfcGxhdGZvcm0=" }}  # ai_platform
immutable: {{ .Values.secrets.immutable | default false }}
---
# Neo4j Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: neo4j-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: neo4j-credentials
    app.kubernetes.io/component: database
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  username: {{ .Values.secrets.neo4j.username | default "bmVvNGo=" }}  # neo4j
  password: {{ .Values.secrets.neo4j.password }}
immutable: {{ .Values.secrets.immutable | default false }}
---
# MinIO Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: minio-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: minio-credentials
    app.kubernetes.io/component: storage
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  accessKey: {{ .Values.secrets.minio.accessKey }}
  secretKey: {{ .Values.secrets.minio.secretKey }}
immutable: {{ .Values.secrets.immutable | default false }}
---
# Grafana Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: grafana-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: grafana-credentials
    app.kubernetes.io/component: monitoring
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  username: {{ .Values.secrets.grafana.username | default "YWRtaW4=" }}  # admin
  password: {{ .Values.secrets.grafana.password }}
immutable: {{ .Values.secrets.immutable | default false }}
---
# Gateway API Keys Secret
{{- if .Values.gateway.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: gateway-api-keys
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: gateway-api-keys
    app.kubernetes.io/component: api
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  apiKeys: {{ .Values.secrets.gateway.apiKeys | default "" }}
immutable: {{ .Values.secrets.immutable | default false }}
{{- end }}
---
# MCPJungle Credentials Secret
{{- if .Values.mcpjungle.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: mcpjungle-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: mcpjungle-credentials
    app.kubernetes.io/component: api
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  apiKeys: {{ .Values.secrets.mcpjungle.apiKeys | default "" }}
immutable: {{ .Values.secrets.immutable | default false }}
---
# GitHub Token Secret
apiVersion: v1
kind: Secret
metadata:
  name: github-token
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: github-token
    app.kubernetes.io/component: integration
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  token: {{ .Values.secrets.mcpjungle.githubToken | default "" }}
immutable: {{ .Values.secrets.immutable | default false }}
---
# Notion API Key Secret
apiVersion: v1
kind: Secret
metadata:
  name: notion-api-key
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: notion-api-key
    app.kubernetes.io/component: integration
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  apiKey: {{ .Values.secrets.mcpjungle.notionApiKey | default "" }}
immutable: {{ .Values.secrets.immutable | default false }}
{{- end }}
---
# Redis Password Secret (optional - Redis can run without password in secure networks)
{{- if .Values.secrets.redis.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: redis-credentials
    app.kubernetes.io/component: cache
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  password: {{ .Values.secrets.redis.password }}
immutable: {{ .Values.secrets.immutable | default false }}
{{- end }}
---
# Qdrant API Key Secret (for Qdrant Cloud or secured instances)
{{- if .Values.secrets.qdrant.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: qdrant-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: qdrant-credentials
    app.kubernetes.io/component: database
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  apiKey: {{ .Values.secrets.qdrant.apiKey }}
immutable: {{ .Values.secrets.immutable | default false }}
{{- end }}
---
# Kong Postgres Credentials Secret
{{- if .Values.kong.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: kong-postgres-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: kong-postgres-credentials
    app.kubernetes.io/component: database
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  username: {{ .Values.secrets.kong.postgresUsername | default "a29uZw==" }}  # kong
  password: {{ .Values.secrets.kong.postgresPassword | default "a29uZ19wYXNzd29yZA==" }}
  database: {{ .Values.secrets.kong.postgresDatabase | default "a29uZw==" }}  # kong
immutable: {{ .Values.secrets.immutable | default false }}
---
# Kong OAuth2 Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: kong-oauth2-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: kong-oauth2-credentials
    app.kubernetes.io/component: auth
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  provisionKey: {{ .Values.kong.oauth2.provisionKey | b64enc }}
  adminClientId: {{ .Values.kong.oauth2.adminClientId | b64enc }}
  adminClientSecret: {{ .Values.kong.oauth2.adminClientSecret | b64enc }}
immutable: {{ .Values.secrets.immutable | default false }}
---
# Kong JWT Keys Secret
apiVersion: v1
kind: Secret
metadata:
  name: kong-jwt-keys
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: kong-jwt-keys
    app.kubernetes.io/component: auth
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: kubernetes.io/tls
data:
  tls.key: {{ .Values.kong.jwt.privateKey }}
  tls.crt: {{ .Values.kong.jwt.publicKey }}
immutable: {{ .Values.secrets.immutable | default false }}
{{- end }}
---
# TLS Certificate Secret (for HTTPS ingress)
{{- if .Values.tls.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: tls-certificate
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: tls-certificate
    app.kubernetes.io/component: security
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.tls.certificate }}
  tls.key: {{ .Values.tls.privateKey }}
  ca.crt: {{ .Values.tls.caCertificate | default "" }}
immutable: {{ .Values.secrets.immutable | default false }}
{{- end }}
---
# Encryption Keys Secret (for application-level encryption)
{{- if .Values.secrets.encryption.applicationKeys.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: encryption-keys
  namespace: {{ .Values.namespace.name }}
  labels:
    app.kubernetes.io/name: encryption-keys
    app.kubernetes.io/component: security
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    {{- if .Values.secrets.encryption.labels }}
    {{- toYaml .Values.secrets.encryption.labels | nindent 4 }}
    {{- end }}
  {{- if .Values.secrets.encryption.annotations }}
  annotations:
    {{- toYaml .Values.secrets.encryption.annotations | nindent 4 }}
  {{- end }}
type: Opaque
data:
  dataEncryptionKey: {{ .Values.secrets.encryption.applicationKeys.dataEncryptionKey }}
  keyEncryptionKey: {{ .Values.secrets.encryption.applicationKeys.keyEncryptionKey }}
immutable: true
{{- end }}
